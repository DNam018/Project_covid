<div id="account">
    <div class="card" style="border: black solid 2px;">
        <div class="card-header text-center">
            <div class="row align-items-center">
                <div class="col-md-10">
                    <i class="fa fa-user" aria-hidden="true" style="font-size: 25px;"></i>
                    <b style="font-size: 25px;">Quản lí tài khoản</b>
                </div>
                <div class="col-md-2">
                    <a class="btn btn-primary float-right" style="color:white;" id="create-user" href="javascript:;"
                        role="button" title="Add">
                        <i class="fa fa-plus" aria-hidden="true"></i> Add
                    </a>
                </div>
            </div>
        </div>
        <div class="card-body">
            <table class="table">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">UserName</th>
                        <th scope="col"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th scope="row">1</th>
                        <td>Larry</td>
                        <td class="text-right">
                            <a class="btn btn-primary" href="javascript:;" role="button" title="Watch">
                                <i class="far fa-eye" aria-hidden="true"></i>
                            </a>
                            <a class="btn btn-primary" href="javascript:;" role="button" title="lock up">
                                <i class="fa fa-key" aria-hidden="true"></i>
                            </a>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">2</th>
                        <td>Covid</td>
                        <td class="text-right">
                            <a class="btn btn-primary" href="javascript:;" role="button" title="Watch">
                                <i class="far fa-eye" aria-hidden="true"></i>
                            </a>
                            <a class="btn btn-primary" href="javascript:;" role="button" title="lock up">
                                <i class="fa fa-key" aria-hidden="true"></i>
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

{{#section 'dialog'}}
   <div id="dialog-form" title="Create new user">
        <p class="validateTips">All form fields are required.</p>     
        <form method="POST" action="/admin/accounts">
            <fieldset>
           <div class="input-group mb-3">
                <span class="input-group-text"> <i class="fa fa-user" aria-hidden="true"></i></span>
                <input type="text" class="form-control" name="username" id="username" placeholder="Username">
            </div>
             <div class="input-group mb-3">
                <span class="input-group-text"> <i class="fa fa-lock" aria-hidden="true"></i></span>
                <input type="password" class="form-control" name="password" id="password" placeholder="Password"/>
            </div>
            <div class="row  ml-3">
                <div class="form-check ml-5">
                    <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios" value="2">
                    <label class="form-check-label" for="gridRadios2">
                        Admin
                    </label>
                </div>
                    <div class="form-check ml-3">
                    <input class="form-check-input" type="radio" name="gridRadios" id="gridRadios" value="3" checked>
                    <label class="form-check-label" for="gridRadios2">
                        Manager
                    </label>
                </div>
            </div>
            <!-- Allow form submission with keyboard without duplicating the dialog button -->
            <input type="submit" tabindex="-1" style="position:absolute; top:-1000px">

            </fieldset>
        </form>
    </div>
{{/section}}


{{#section 'css'}}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.13.0/themes/base/jquery-ui.css">
    <!-- Bootstrap CSS CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <!-- Our Custom CSS -->
    <link rel="stylesheet" href="/assets/css/navBar.css">
    <link href='https://fonts.googleapis.com/css?family=Mulish' rel='stylesheet'>
    <!-- Font Awesome JS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">

    {{> css/accountCss }}
{{/section}}

{{#section 'nav'}}
    {{> navbarAdmin }}
{{/section}}

{{#section 'script'}}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <!-- Jquety ui and Jquery JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>

    <!-- Popper.JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>

    <script>
        $(document).ready(function () {
            var dialog, form,
        
            username = $("#username"),
            password = $("#password"),
            allFields = $([]).add(username).add(password),
            tips = $(".validateTips");
            
            function updateTips(t) {
                tips.text(t).addClass("ui-state-highlight");
                setTimeout(function() {
                    tips.removeClass("ui-state-highlight", 1500 );
                }, 500);
            }
        
            function checkLength(o, n, min, max) {
                if (o.val().length > max || o.val().length < min) {
                    o.addClass( "ui-state-error" );
                    updateTips( "Length of " + n + " must be between " +
                    min + " and " + max + "." );
                    return false;
                } else {
                    return true;
                }
            }
        
            function checkRegexp(o, regexp, n) {
                if (!(regexp.test(o.val()))) {
                    o.addClass("ui-state-error");
                    updateTips(n);
                    return false;
                } else {
                    return true;
                }
            }
        
            function addUser() {
                var valid = true;
                allFields.removeClass("ui-state-error");

                valid = valid && checkLength(username, "username", 3, 16);
                valid = valid && checkLength(password, "password", 5, 16);
            
                valid = valid && checkRegexp(username, /^[a-z]([0-9a-z_\s])+$/i, "Username may consist of a-z, 0-9, underscores, spaces and must begin with a letter.");
                valid = valid && checkRegexp(password, /^([0-9a-zA-Z])+$/, "Password field only allow : a-z 0-9");

                if (valid) {
                    $.ajax({
                        url: "/admin/accounts",
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({
                            username: username.val(),
                            password: password.val(),
                        }),
                        success: function (res) {
                            $(".card-body tbody").append(`<tr>
                                <th scope="row">${res.id}</th>
                                <td>${res.username}</td>
                                <td class="text-right">
                                <a class="btn btn-primary" href="javascript:;" role="button" title="Watch">
                                <i class="far fa-eye" aria-hidden="true"></i>
                                </a>
                                <a class="btn btn-primary" href="javascript:;" role="button" title="lock up">
                                <i class="fa fa-key" aria-hidden="true"></i>
                                </a>
                                </td>
                            </tr>`);
                            tips.text("All form fields are required.").addClass("ui-state-error");
                            dialog.dialog("close");
                        }
                    });
                }
                return valid;
            }
        
            dialog = $("#dialog-form").dialog({
                autoOpen: false,
                height: 300,
                width: 350,
                modal: true,
                buttons: {
                    CreateUser:{ 
                        type: "submit",
                        url: "/admin/accounts",
                        class: "CreateButton btn btn-primary",
                        text: "Create",
                        click : addUser
                    },
                    Cancel: {
                        class: "CancelButton btn btn-primary",
                        text: "Cancel",
                        click: function() {
                            tips.text("All form fields are required.");
                            dialog.dialog("close");
                        }  
                    }
                },
                close: function() {
                    form[0].reset();
                    tips.text("Điền các trường được yêu cầu.");
                    allFields.removeClass("ui-state-error");
                }
            });
        
            form = dialog.find("form").on("submit", function(event) {
                event.preventDefault();
                addUser();
            });
        
            $("#create-user").button().on("click", function() {
                dialog.dialog("open");
            });
    });
    </script>
{{/section}}